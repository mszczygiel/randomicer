(this["webpackJsonprandomicer-web"]=this["webpackJsonprandomicer-web"]||[]).push([[0],{78:function(e,t,n){e.exports=n(89)},83:function(e,t,n){},84:function(e,t,n){},89:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),u=n(22),o=n.n(u),c=(n(83),n(84),n(72)),l=n(18),i=n(12),m=n(17),s=n(39),d=n(26),h=n(38),p=Object(h.createAction)("@randomicer/MICE_LOADED")(),f=Object(h.createAction)("@randomicer/RANDOMIZATION_STARTED")(),b=Object(h.createAction)("@randomicer/SET_DISTRIBUTION")(),E=Object(h.createReducer)({mice:[],isRunningRandomization:!1}).handleType("@randomicer/MICE_LOADED",(function(e,t){return Object(d.a)(Object(d.a)({},e),{},{mice:t.payload.mice})})).handleType("@randomicer/RANDOMIZATION_STARTED",(function(e,t){return Object(d.a)(Object(d.a)({},e),{},{isRunningRandomization:!0})})).handleType("@randomicer/SET_DISTRIBUTION",(function(e,t){return Object(d.a)(Object(d.a)({},e),{},{distribution:t.payload,isRunningRandomization:!1})})),v=n(40),g=Object(m.b)((function(e){return{mice:e.mice}}))((function(e){return r.a.createElement(v.a,{hover:!0,size:"sm"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"mouse id"),r.a.createElement("th",null,"tumors"),r.a.createElement("th",null,"volume"))),r.a.createElement("tbody",null,e.mice.map((function(e){return r.a.createElement("tr",{key:e.id},r.a.createElement("td",null,e.id),r.a.createElement("td",null,e.tumors.length),r.a.createElement("td",null,e.tumorsVolume()))}))))})),O=n(8),j=n(28),w=n(73),y=n(15),N=n(20),T=function(){function e(t,n){Object(y.a)(this,e),this.width=void 0,this.height=void 0,this.width=t,this.height=n}return Object(N.a)(e,[{key:"volume",value:function(){var e=Math.min(this.width,this.height);return.5*e*e*Math.max(this.width,this.height)}}]),e}(),x=function(){function e(t,n){Object(y.a)(this,e),this.id=void 0,this.tumors=void 0,this.id=t,this.tumors=Array.from(n)}return Object(N.a)(e,[{key:"tumorsVolume",value:function(){return this.tumors.map((function(e){return e.volume()})).reduce((function(e,t){return t+e}),0)}}]),e}(),R=n(68),M=n(74),V=n(101),S=n(92),k=n(69),_=n(93),z=n(94),D=n(95);function A(e){var t=Object(R.parse)(e,{delimiter:";",skipEmptyLines:!0}),n=[];return M.a(t.data).pipe(Object(S.a)(2),Object(k.a)((function(e){return function(e,t){var n=e[0].trim(),a=[];return V.a(M.a(e),M.a(t)).pipe(Object(z.a)(1),Object(k.a)((function(e){var t=Object(O.a)(e,2),n=t[0],a=t[1];return[n.trim().replace(",","."),a.trim().replace(",",".")]})),Object(D.a)((function(e){var t=Object(O.a)(e,2),n=t[0],a=t[1];return n.length>0&&a.length>0})),Object(k.a)((function(e){var t=Object(O.a)(e,2),n=t[0],a=t[1];return new T(Number.parseFloat(n),Number.parseFloat(a))})),Object(_.a)()).subscribe((function(e){return a=e})),new x(n,a)}(e[0],e[1])})),Object(_.a)()).subscribe((function(e){return n=e})),n}var F={onLoaded:p},I=Object(m.b)(void 0,F)((function(e){function t(t){var n;if("string"===typeof(null===(n=t.target)||void 0===n?void 0:n.result)){var a=A(t.target.result);e.onLoaded({mice:a})}}return r.a.createElement("div",{className:"input-group"},r.a.createElement("input",{type:"file",accept:".txt,.csv,text/plain,text/csv",onChange:function(e){var n,a=null===(n=e.target.files)||void 0===n?void 0:n.item(0);if(a){var r=new FileReader;r.onloadend=t,r.readAsText(a)}}}))})),G=n(99),C=function(){function e(t){Object(y.a)(this,e),this.mice=void 0,this.mice=t}return Object(N.a)(e,[{key:"tumorsMedian",value:function(){return Object(G.d)(this.volumes())}},{key:"tumorsMean",value:function(){return Object(G.c)(this.volumes())}},{key:"tumorsStdDev",value:function(){return Object(G.f)(this.volumes())}},{key:"volumes",value:function(){return this.mice.map((function(e){return e.tumorsVolume()}))}}]),e}(),L=function e(t){Object(y.a)(this,e),this.groups=void 0,this.groups=t},P=function e(t){Object(y.a)(this,e),this.message=void 0,this.message=t};var U=n(37),B=n(96),X=n(97),J=n(98),W=n(56),Z=n(100),q=n(102),$=function(){function e(){Object(y.a)(this,e)}return Object(N.a)(e,[{key:"name",value:function(){return"experimental"}},{key:"randomize",value:function(t,n){var a=this,r=Object(G.b)(1e3,Object(G.e)(t.length*t.length,1e4)),u={initialState:Object(U.a)(t),iterate:function(e){return a.shuffle(e)},resultSelector:function(e){return e},scheduler:Z.a};return q.a(u).pipe(Object(B.a)(r),Object(X.a)((function(e){return a.createDistribution(e,n)})),Object(J.a)((function(t,n){return e.penalty(t)-e.penalty(n)}))).toPromise()}},{key:"createDistribution",value:function(e,t){var n=t.micePerGroup*t.numberOfGroups;return M.a(e).pipe(Object(B.a)(n),Object(S.a)(t.micePerGroup),Object(_.a)(),Object(k.a)((function(e){return e.map((function(e){return new C(e)}))})),Object(k.a)((function(e){return new L(e)})))}},{key:"shuffle",value:function(e){for(var t=e.length,n=Object(U.a)(e);0!==t;){var a=Math.floor(Math.random()*t),r=n[t-=1];n[t]=n[a],n[a]=r}return n}}],[{key:"penalty",value:function(e){var t=0,n=Object(G.g)(e.groups.map((function(e){return e.tumorsMean()}))),a=Object(G.g)(e.groups.map((function(e){return e.tumorsMedian()})));return M.a(e.groups).pipe(Object(X.a)((function(t){return M.a(e.groups).pipe(Object(k.a)((function(e){return[t,e]})))}))).pipe(Object(W.a)((function(e,t){var r=Object(O.a)(t,2);return e+function(e,t){var r=Object(G.a)(e.tumorsMean()-t.tumorsMean())/n;return 2*(Object(G.a)(e.tumorsMedian()-t.tumorsMedian())/a)+r}(r[0],r[1])}),0)).subscribe((function(e){t=e})),t}}]),e}(),H=function(){function e(){Object(y.a)(this,e)}return Object(N.a)(e,[{key:"name",value:function(){return"snake"}},{key:"randomize",value:function(e,t){for(var n=Object(U.a)(e).sort((function(e,t){return t.tumorsVolume()-e.tumorsVolume()})),a=[],r=0;r<t.numberOfGroups;r++)a.push([]);for(var u=t.micePerGroup*t.numberOfGroups,o=0,c=1,l=0;l<u;l++)a[o].push(n[l]),1===c&&o===t.numberOfGroups-1?c=-1:-1===c&&0===o?c=1:o+=c;var i=a.map((function(e){return new C(e)}));return Promise.resolve(new L(i))}}]),e}(),K=[new $,new H],Q=K.map((function(e){return e.name()})),Y=K[0];var ee={setRandomizationResult:b,randomizationStarted:f},te=Object(m.b)((function(e){return{mice:e.mice,randomizationRunning:e.isRunningRandomization}}),ee)((function(e){var t=Object(a.useState)(2),n=Object(O.a)(t,2),u=n[0],o=n[1],c=Object(a.useState)(2),m=Object(O.a)(c,2),s=m[0],d=m[1],h=Object(a.useState)(void 0),p=Object(O.a)(h,2),f=p[0],b=p[1],E=Object(a.useState)(void 0),v=Object(O.a)(E,2),g=v[0],y=v[1],N=Object(a.useState)(Y),T=Object(O.a)(N,2),x=T[0],R=T[1],M=Object(a.useState)(""),V=Object(O.a)(M,2),S=V[0],k=V[1],_=e.mice.length>1&&!e.randomizationRunning;function z(){var t=function(e,t,n,a){var r=e.filter((function(e){return null==a.minTumorsVolume||e.tumorsVolume()>=a.minTumorsVolume})).filter((function(e){return null==a.maxTumorsVolume||e.tumorsVolume()<=a.maxTumorsVolume})),u=n.micePerGroup*n.numberOfGroups;return u>r.length?new P("Number of mice meeting criteria (".concat(r.length,") is less than number of groups x number of mice per group (").concat(u,")")):t.randomize(r,n)}(e.mice,x,{micePerGroup:s,numberOfGroups:u},{minTumorsVolume:f,maxTumorsVolume:g});t instanceof P?k(t.message):t instanceof Promise&&(e.randomizationStarted(),t.then((function(t){return e.setRandomizationResult(t)})))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,null,r.a.createElement(i.a,{className:"text-center"},r.a.createElement(I,null))),r.a.createElement(l.a,null,r.a.createElement(i.a,null,r.a.createElement("label",{htmlFor:"no-of-groups"},"No of groups"),r.a.createElement("div",{className:"input-group"},r.a.createElement("input",{id:"no-of-groups",className:"form-control",type:"number",placeholder:"No of groups",min:"2",value:u,onChange:function(e){return o(e.target.valueAsNumber)}}))),r.a.createElement(i.a,null,r.a.createElement("label",{htmlFor:"mice-per-group"},"Mice per group"),r.a.createElement("div",{className:"input-group"},r.a.createElement("input",{id:"mice-per-group",className:"form-control",type:"number",placeholder:"Mice per group",min:"2",value:s,onChange:function(e){return d(e.target.valueAsNumber)}}))),r.a.createElement(i.a,null,r.a.createElement("label",{htmlFor:"lower-tumor-threshold"},"Min TV"),r.a.createElement("div",{className:"input-group"},r.a.createElement("input",{id:"lower-tumor-threshold",className:"form-control",type:"number",step:"0.01",placeholder:"Lower TV threshold",min:"0",value:f||"",onChange:function(e){""===e.target.value?b(void 0):b(e.target.valueAsNumber)}}))),r.a.createElement(i.a,null,r.a.createElement("label",{htmlFor:"upper-tumor-threshold"},"Max TV"),r.a.createElement("div",{className:"input-group"},r.a.createElement("input",{id:"upper-tumor-threshold",className:"form-control",type:"number",step:"0.01",placeholder:"Upper TV threshold",min:"0",value:g||"",onChange:function(e){""===e.target.value?y(void 0):y(e.target.valueAsNumber)}})))),r.a.createElement(l.a,null,r.a.createElement(i.a,{md:"3"},r.a.createElement("label",{htmlFor:"algorithm"},"Algorithm"),r.a.createElement("div",{className:"input-group"},r.a.createElement("select",{id:"algorithm",onChange:function(e){R(function(e){var t=K.find((function(t){return t.name()===e}));if(void 0===t)throw new Error("algorithm ".concat(e," not found"));return t}(e.target.value))}},Q.map((function(e){return r.a.createElement("option",{key:"algorithm-".concat(e),className:"form-control",value:e},e)})))))),r.a.createElement(l.a,null,r.a.createElement(i.a,null,S.trim().length>0?r.a.createElement(w.a,{variant:"danger"},S):null)),r.a.createElement(l.a,{className:"mt-3"},r.a.createElement(i.a,{className:"text-center"},r.a.createElement(j.a,{disabled:!_,className:"btn btn-primary",onClick:function(){return z()}},e.randomizationRunning?r.a.createElement("span",{className:"spinner-border spinner-border-sm",role:"status"}):null,"Randomize"))))})),ne=function(e){var t=["_ _","o _","_ o","o o","oo _","_ oo","oo oo","o oo","oo o"];var n=new File(e.distribution.groups.map((function(e,n){return function(e,n){var a="Sym;LP;TV;NT;G".concat(n,";AVG;").concat(e.tumorsMean(),";MED;").concat(e.tumorsMedian(),";SD;").concat(e.tumorsStdDev()),r="";return e.mice.sort((function(e,t){return t.tumorsVolume()-e.tumorsVolume()})).forEach((function(e,n){r+="".concat(t[n%t.length],";").concat(e.id,";").concat(e.tumorsVolume(),";").concat(e.tumors.length,"\n")})),"".concat(a,"\n").concat(r)}(e,n+1)})),"result.csv"),a=URL.createObjectURL(n);return r.a.createElement("a",{href:a,download:!0},r.a.createElement(j.a,{variant:"success"},"Download"))},ae=function(e){var t=e.group.mice.sort((function(e,t){return t.tumorsVolume()-e.tumorsVolume()}));return r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,"G",e.id+1," AVG(",e.group.tumorsMean().toFixed(3),") MED(",e.group.tumorsMedian().toFixed(3),") SD(",e.group.tumorsStdDev().toFixed(3),")"),r.a.createElement(v.a,{size:"sm"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"id"),r.a.createElement("th",null,"TV"),r.a.createElement("th",null,"NT"))),r.a.createElement("tbody",null,t.map((function(e){return r.a.createElement("tr",{key:"mouse-".concat(e.id)},r.a.createElement("td",null,e.id),r.a.createElement("td",null,e.tumorsVolume()),r.a.createElement("td",null,e.tumors.length))})))))},re=Object(m.b)((function(e){return{distribution:e.distribution}}))((function(e){return void 0===e.distribution?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(ne,{distribution:e.distribution}),e.distribution.groups.map((function(e,t){return r.a.createElement(ae,{key:"group-".concat(t),group:e,id:t})})))})),ue=n(71),oe=function(){var e=Object(a.useState)(!1),t=Object(O.a)(e,2),n=t[0],u=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,{variant:"secondary",size:"sm",onClick:function(){return u(!n)},"aria-expanded":n},r.a.createElement("svg",{className:"bi bi-question-circle",width:"2em",height:"2em",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}),r.a.createElement("path",{d:"M5.25 6.033h1.32c0-.781.458-1.384 1.36-1.384.685 0 1.313.343 1.313 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.007.463h1.307v-.355c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.326 0-2.786.647-2.754 2.533zm1.562 5.516c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"}))),r.a.createElement(ue.a,{in:n},r.a.createElement("div",{className:"text-justify"},r.a.createElement("h5",null,"File format:"),r.a.createElement("p",null,"Each mouse entry spans 2 rows and N columns (where N = max number of tumors in any mouse). Columns are separated with ",r.a.createElement("em",null,";")),r.a.createElement("p",null,"For example, to represent 5 mice, where mouse with id 2 has two tumors (3.5x4.1 and 1.2x2.1), whereas rest have 1 (all 3.5x4.1) one could prepare file with the following content:"),r.a.createElement("pre",null,"1;3.5;",r.a.createElement("br",null),";4.1;",r.a.createElement("br",null),"2;3.5;1.2",r.a.createElement("br",null),";4.1;2.1",r.a.createElement("br",null),"3;3.5;",r.a.createElement("br",null),";4.1;",r.a.createElement("br",null),"4;4.1;",r.a.createElement("br",null),";3.5;",r.a.createElement("br",null),"5;3.5;",r.a.createElement("br",null),";4.1;"),r.a.createElement("h5",null,"Issues"),r.a.createElement("p",null,"If you encounter any issue or have improvement idea, please use raise issue on ",r.a.createElement("a",{href:"https://github.com/mszczygiel/randomicer/issues",target:"__blank"},"Github")))))},ce=Object(s.b)(E,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());var le=function(){return r.a.createElement(m.a,{store:ce},r.a.createElement(c.a,null,r.a.createElement(l.a,{className:"align-items-center"},r.a.createElement(i.a,{className:"text-center"},r.a.createElement("h1",{className:"text-primary"},"Randomicer"))),r.a.createElement(l.a,null,r.a.createElement(i.a,{sm:{offset:6},className:"text-right"},r.a.createElement(oe,null))),r.a.createElement(te,null),r.a.createElement("hr",null),r.a.createElement(l.a,null,r.a.createElement(i.a,null,r.a.createElement("h3",{className:"text-center"},"Input"),r.a.createElement(g,null)),r.a.createElement(i.a,{className:"text-center"},r.a.createElement("h3",null,"Output"),r.a.createElement(re,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(le,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[78,1,2]]]);
//# sourceMappingURL=main.ae5d038e.chunk.js.map